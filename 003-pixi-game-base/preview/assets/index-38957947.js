var _=Object.defineProperty;var X=(s,e,t)=>e in s?_(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(X(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const E=[],U=function(){if(E.length)return new PIXI.AnimatedSprite(E);for(let s=0;s<5;s++){const e=document.createElement("canvas"),t=e.getContext("2d");let i=s;(()=>{e.width=32,e.height=128,t.strokeStyle="#67e8f9",t.shadowColor="#cffafe",t.fillStyle="#67e8f9",t.lineWidth=32/32,t.shadowBlur=32/16;const c=32*.1;t.beginPath(),i===0?t.fillRect(32/2-c/2,128*.05,c,128*.13):i===1?t.fillRect(32/2-c/2,128*.25,c,128*.22):i===2?t.fillRect(32/2-c/2,128*.5,c,128*.25):i===3?(t.fillRect(32/2-c/2,128*.75,c,128*.18),t.ellipse(32/2,128-32*15/100,32*.225,32*.05,0,Math.PI*2,0,!1)):t.ellipse(32/2,128-32*15/100,32*.45,32*.1,0,Math.PI*2,0,!1),t.stroke()})(),E.push(PIXI.Texture.from(e)),document.body.appendChild(e)}return new PIXI.AnimatedSprite(E)},G=function(){const s=document.createElement("canvas");s.width=512,s.height=512;const e=s.getContext("2d");let t=[];const i=[],n=512,o=485,r=n/5,c=n/12,h=o/16,l=o/32;let d=0,f=o,v=0;for(i.length=0,t.length=0,t.push([d+n/2,f]);f>0&&v<100;){f-=Math.random()*h+v*2+l,f<0&&(f=0);const w=Math.random()*r-r/2+(Math.random()-.5)*c;d+w>n/2||d+w<-n/2?d-=w:d+=w,t.push([d+n/2,f]),v++}for(let w=0;w<4;w++){i.push(t);const M=[];for(let p=0;p<t.length;p++)M.push([t[p][0],t[p][1]]);i.push(M)}for(let w=0;w<i.length;w++){const M=1/(i.length-w);e.strokeStyle="#E0F2FE",e.shadowColor="#7DD3FC",e.lineCap="round",e.lineWidth=4*M+2,e.shadowBlur=12*M+4,e.shadowOffsetX=0,e.shadowOffsetY=0,e.beginPath(),t=i[w],e.moveTo(t[0][0],t[0][1]);for(let p=1;p<t.length;p++)e.lineTo(t[p][0]+(Math.random()-.5)*(p+e.lineWidth),t[p][1]+Math.random()*e.lineWidth);e.stroke()}return PIXI.Texture.from(s)},z=function(){const s=new PIXI.Geometry().addAttribute("aVertexPosition",[-100,-100,100,-100,100,100],2).addAttribute("aColor",[1,0,0,0,1,0,0,0,1],3).addAttribute("aUvs",[0,0,1,0,1,1],2),e=`

    precision mediump float;

    attribute vec2 aVertexPosition;
    attribute vec3 aColor;
    attribute vec2 aUvs;

    uniform mat3 translationMatrix;
    uniform mat3 projectionMatrix;

    varying vec2 vUvs;
    varying vec3 vColor;

    void main() {

        vUvs = aUvs;
        vColor = aColor;
        gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    }`,t=`

    precision mediump float;

    varying vec3 vColor;
    varying vec2 vUvs;

    uniform sampler2D uSampler2;

    void main() {

        gl_FragColor = texture2D(uSampler2, vUvs) * vec4(vColor, 1.0);
    }`,i={uSampler2:PIXI.Texture("assets/bunny.png")},n=PIXI.Shader.from(e,t,i),o=new PIXI.Mesh(s,n);return o.position.set(400,300),o.scale.set(2),o},m={SQUARE_100:(s=16777215)=>{const e=new PIXI.Rectangle(0,0,100,100),t=new PIXI.Graphics;return t.beginFill(s),t.drawShape(e),t.endFill(),t},CIRCLE_100:(s=16777215)=>{const e=new PIXI.Graphics;return e.beginFill(s),e.drawCircle(0,0,50),e.endFill(),e},LIGHTNING_BOLT:()=>new PIXI.Sprite(G()),LIGHTNING_BOLT_SIMPLE:()=>{const s=new PIXI.Graphics,e=512,t=512;for(let i=0,n=Math.random()*e-e/2,o=-t/2,r=10,c=100;i<10;i++)s.lineStyle(r,8246268,1),s.moveTo(n,o),n+=Math.random()*c-c/2,s.lineTo(n,o+c),o+=c,r-=1,c*=.8;return s.closePath(),s},LIGHTNING_BOLT_MULTIPASS:()=>{const s=new PIXI.Graphics,e=512,t=512;s.line;for(let i=0,n=Math.random()*e-e/2,o=-t/2,r=4,c=100;i<14;i++){let h=Math.floor(Math.random()*50);s.lineStyle(r,(125-h)*256*256+(211-h)*256+(252-h),1);const l=Math.random()*c*2-c*2/2;for(let d=0;d<4;d++)s.moveTo(n+Math.random()*8,o+Math.random()*8),s.lineTo(n+l+Math.random()*8,o+c+Math.random()*8);n+=l,o+=c,c*=.8}return s.closePath(),s},TRIANGLE_MESH:z,RAIN_DROP_MOVIECLIP:U},u={BUTTON:"BUTTON",JOYSTICK:"JOYSTICK",PLAYER:"PLAYER",ENEMY:"ENEMY",LIGHTNING_BOLT:"LIGHTNING_BOLT",RAIN_DROP_MOVIECLIP:"RAIN_DROP_MOVIECLIP"};class V{constructor(){a(this,"assetMap",new Map)}mapAssets(e){for(let t in e)this.assetMap.set(t,e[t])}async loadAssets(e){const t=e.map(i=>(PIXI.Assets.add(i.name,[i.url]),PIXI.Assets.load(i.name)));await Promise.all(t)}async generateAssets(){}}const b=class extends PIXI.utils.EventEmitter{constructor(){super();a(this,"keys",{w:!1,s:!1,a:!1,d:!1,1:!1,0:!1});a(this,"enabled",!1);a(this,"onKeyDown",({key:t})=>{t in this.keys&&(this.keys[t]=!0,this.emit(b.EVENTS.KEYDOWN,{key:t}))});a(this,"onKeyUp",({key:t})=>{t in this.keys&&(this.keys[t]=!1,this.emit(b.EVENTS.KEYUP,{key:t}))})}enable(){this.enabled||(this.enabled=!0,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp))}disable(){this.enabled&&(this.enabled=!1,window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp))}};let I=b;a(I,"EVENTS",{KEYDOWN:"KEYDOWN",KEYDOWN:"KEYUP"});const y={globals:void 0},Y=function(s){y.game=s},L=()=>y.game.renderer,C=()=>y.game.assetManager,k=()=>y.game.player.view.position,g=()=>({width:y.game.renderer.width,height:y.game.renderer.height});class j{constructor(){a(this,"view",new PIXI.Container);const e=this.view=m.SQUARE_100(2565930);e.alpha=.99;const t=g();e.width=t.width,e.height=t.height,L().on("resize",()=>{const i=g();e.width=i.width,e.height=i.height})}}const D=function(s){return Math.hypot(s.x,s.y)},K=function(s,e){const t=e.clone();return t.x-=s.x,t.y-=s.y,t},B=function(){let s=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(s=!0)}(navigator.userAgent||navigator.vendor||window.opera),s},A=function(s,e,t){let i=performance.now();return{update:()=>{const n=performance.now();n-i>e&&(i=n,s.call(t))}}};class O{constructor(e=m.SQUARE_100){a(this,"view",new PIXI.Container);a(this,"velocity",new PIXI.Point(0,0));a(this,"direction",new PIXI.Point(0,0));a(this,"maxVelocity",1);this.view=e(),this.view.pivot.set(25,25)}update(e){const t=D(this.direction);this.velocity.x=this.direction.x/t*this.maxVelocity||0,this.velocity.y=this.direction.y/t*this.maxVelocity||0,this.view.x+=this.velocity.x*e,this.view.y+=this.velocity.y*e}}class F extends O{constructor(t){super(t);a(this,"maxVelocity",3);this.view.tint=15680580}}class H{constructor(){a(this,"view",new PIXI.Container);a(this,"list",[]);a(this,"spawnTimer")}initialize(){this.spawnTimer=A(this.spawn,1e3,this);for(let e=0;e<10;e++)this.spawn()}spawn(){const e=new F(C().assetMap.get(u.ENEMY)),{width:t,height:i}=g(),n=k();e.view.position.set(Math.random(),Math.random()),Math.random()>.5?e.view.position.x=Math.random()>.5?0:1:e.view.position.y=Math.random()>.5?0:1,e.view.position.x*=t,e.view.position.x-=t/2-n.x,e.view.position.y*=i,e.view.position.y-=i/2-n.y,e.view.scale.set(.5),this.list.push(e),this.view.addChild(e.view)}update(e){this.spawnTimer.update(),this.list.forEach(t=>{const i=K(t.view.position,k());t.direction.copyFrom(i),t.update(e)})}}const N=class extends PIXI.utils.EventEmitter{constructor(t=16777215){super();a(this,"view",new PIXI.Container);a(this,"pressed",!1);a(this,"direction",new PIXI.Point);const i=m.CIRCLE_100(t);this.view.addChild(i),this.view.hitArea=new PIXI.Circle(0,0,150);const n=new PIXI.Graphics;n.beginFill(t),n.drawCircle(this.view.hitArea.x,this.view.hitArea.y,this.view.hitArea.radius),n.endFill(),n.alpha=.04,this.view.addChild(n),this.view.interactive=!0,this.view.cursor="pointer";const o=r=>{this.pressed=r,i.tint=r?11184810:16777215,r||i.position.set(0,0),this.direction.copyFrom(i.position),this.emitUpdate()};this.view.on("pointerdown",r=>{this.view.toLocal(r.global,null,i.position),o(!0),this.direction.copyFrom(i.position)}),this.view.on("pointerup",()=>{o(!1)}),this.view.on("pointerupoutside",()=>{o(!1)}),this.view.on("pointerout",()=>{o(!1)}),this.view.on("pointermove",r=>{this.pressed&&(this.view.toLocal(r.global,null,i.position),this.direction.copyFrom(i.position),this.emitUpdate())})}emitUpdate(){this.emit(N.EVENTS.INPUT,{direction:this.direction.clone()})}};let x=N;a(x,"EVENTS",{INPUT:"INPUT"});class W extends O{constructor(t){super(t);a(this,"maxVelocity",5);this.view.scale.set(.5),this.view.tint=8702998}connectKeyboard(t){t.on(I.EVENTS.KEYDOWN,({key:i})=>{i==="w"?this.direction.y=-1:i==="s"?this.direction.y=1:i==="a"?this.direction.x=-1:i==="d"&&(this.direction.x=1)}),t.on(I.EVENTS.KEYUP,({key:i})=>{i==="w"?this.direction.y=t.keys.s?1:0:i==="s"?this.direction.y=t.keys.w?-1:0:i==="a"?this.direction.x=t.keys.d?1:0:i==="d"&&(this.direction.x=t.keys.a?-1:0)})}connectJoystick(t){t.on(x.EVENTS.INPUT,({direction:i})=>{this.direction.copyFrom(i)})}}class Q{constructor(){}update(e){}}class q{constructor(){a(this,"view",new PIXI.Container);a(this,"spawnTimer");a(this,"mockupLightingTimer")}initialize(){this.spawnTimer=A(this.mockupRain,300,this)}mockupLighting(){const e=C().assetMap.get(u.LIGHTNING_BOLT)(),{width:t,height:i}=g();e.x=Math.random()*t-t/2,e.y=-i/2,this.view.addChild(e)}mockupRain(){const e=C().assetMap.get(u.RAIN_DROP_MOVIECLIP)(),{width:t,height:i}=g();e.x=Math.random()*t-t/2,e.y=Math.random()*i-i/2,console.log(e),e.scale.set(.5),e.animationSpeed=.2,e.play(),this.view.addChild(e)}update(e){this.spawnTimer.update(e)}}class J{constructor(){a(this,"view",new PIXI.Container)}update(e){}}class P extends PIXI.utils.EventEmitter{constructor(t=null,i=16777215){super();a(this,"view",new PIXI.Container);a(this,"pressed",!1);const n=m.SQUARE_100(i);if(this.view.addChild(n),t){const r=new PIXI.Text(t);r.anchor.set(.5,.5),r.position.set(50,50),this.view.addChild(r)}this.view.interactive=!0,this.view.cursor="pointer";const o=r=>{this.pressed=r,n.tint=r?14342874:16777215};this.view.on("pointerdown",()=>{o(!0)}),this.view.on("pointerup",()=>{o(!1)}),this.view.on("pointerupoutside",()=>{o(!1)})}}a(P,"EVENTS",{PRESSED:"PRESSED"});class Z{constructor(){a(this,"view",new PIXI.Container);a(this,"joystick",null);const e=new PIXI.Container;this.view.addChild(e);const t=new P("1",4841033),i=new P("2",14567753),n=new P("3",4803038),o=B()?1.5:1,r=()=>{const h=g(),l=(h.height+h.width)*.02*o,d=l*.2;[t,i,n].forEach((f,v)=>{f.view.scale.set(l/100),f.view.position.set(l*v+d*(v+1),0)}),e.y=h.height-l-d};r(),e.addChild(t.view,i.view,n.view),this.joystick=new x(16448250),this.view.addChild(this.joystick.view);const c=()=>{const h=g(),l=(h.height+h.width)*.08*o;this.joystick.view.scale.set(l/300),this.joystick.view.position.set(h.width-l*.5,h.height-l*.5)};c(),L().on("resize",()=>{r(),c()})}}class R{constructor(e,t,i){a(this,"view",new PIXI.Container);a(this,"renderer");a(this,"ticker");a(this,"assetMap");a(this,"assetManager");a(this,"background");a(this,"player");a(this,"ui");a(this,"gameStage");a(this,"keyboardManager");a(this,"effectsManager");a(this,"collisionManager");a(this,"projectileManager");a(this,"enemiesManager");this.renderer=e.renderer,this.ticker=e.ticker,console.log(e.ticker),this.assetMap=t,this.assetList=i}async initialize(){Y(this),this.assetManager=new V,this.assetManager.mapAssets(this.assetMap);const e=this.assetManager.loadAssets(this.assetList),t=this.assetManager.generateAssets();this.keyboardManager=new I,this.effectsManager=new q,this.collisionManager=new Q,this.projectileManager=new J,this.enemiesManager=new H,await e,await t,await this.initializeViews()}async initializeViews(){this.background=new j,this.player=new W(this.assetManager.assetMap.get(u.PLAYER)),this.ui=new Z,this.gameStage=new PIXI.Container,this.view.addChild(this.background.view),this.view.addChild(this.gameStage),this.gameStage.addChild(this.enemiesManager.view),this.gameStage.addChild(this.player.view),this.gameStage.addChild(this.projectileManager.view),this.gameStage.addChild(this.effectsManager.view),this.view.addChild(this.ui.view)}start(){this.enemiesManager.initialize(),this.effectsManager.initialize(),this.keyboardManager.enable(),this.player.connectKeyboard(this.keyboardManager),this.ui.joystick&&this.player.connectJoystick(this.ui.joystick);const e=()=>{this.gameStage.pivot.set(-this.renderer.width/2+this.player.view.x,-this.renderer.height/2+this.player.view.y)};this.ticker.add(e),this.ticker.add(this.player.update,this.player),this.ticker.add(this.enemiesManager.update,this.enemiesManager),this.ticker.add(this.effectsManager.update,this.effectsManager),this.ticker.add(this.collisionManager.update,this.collisionManager),this.ticker.add(this.projectileManager.update,this.projectileManager)}}a(R,"ASSETS",{BUTTON:"BUTTON",JOYSTICK:"JOYSTICK",PLAYER:"PLAYER",ENEMY:"ENEMY",LIGHTNING_BOLT:"LIGHTNING_BOLT"});const S=new PIXI.Application({resizeTo:window});document.body.appendChild(S.view);const $=[{name:"bunny",url:"assets/bunny.png"},{name:"txtr",url:"assets/txtr.png"}],ee={[u.BUTTON]:m.SQUARE_100,[u.JOYSTICK]:m.CIRCLE_100,[u.PLAYER]:m.SQUARE_100,[u.ENEMY]:m.SQUARE_100,[u.LIGHTNING_BOLT]:m.LIGHTNING_BOLT,[u.RAIN_DROP_MOVIECLIP]:m.RAIN_DROP_MOVIECLIP};window.__stage=S.stage;const T=new R(S,ee,$);T.initialize().then(()=>{S.stage.addChild(T.view),T.start()});
