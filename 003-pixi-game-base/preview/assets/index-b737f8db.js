var g=Object.defineProperty;var x=(n,e,i)=>e in n?g(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var r=(n,e,i)=>(x(n,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();let y=null,w=null;const P=function(n){y=n.player,w=n.app},C=()=>y.view.position,a=()=>({width:w.renderer.width,height:w.renderer.height}),m=()=>w.renderer;class S{constructor(){r(this,"view",new PIXI.Container);const e=this.view=new PIXI.Graphics;e.beginFill(2565930),e.drawRect(0,0,50,50),e.endFill(),e.alpha=.99;const i=a();e.width=i.width,e.height=i.height,m().on("resize",()=>{const t=a();e.width=t.width,e.height=t.height})}}const I=function(n){return Math.hypot(n.x,n.y)},N=function(n){const e=I(n);return n.x=n.x/e||0,n.y=n.y/e||0,n},X=function(n,e){const i=e.clone();return i.x-=n.x,i.y-=n.y,i},T=function(n,e,i){let t=performance.now();return{update:()=>{const s=performance.now();s-t>e&&(t=s,n.call(i))}}};class E{constructor(){r(this,"view",new PIXI.Container);r(this,"velocity",new PIXI.Point(0,0));r(this,"direction",new PIXI.Point(0,0));r(this,"maxVelocity",1);const e=new PIXI.Graphics;e.beginFill(16777215),e.drawRect(0,0,50,50),e.endFill(),this.view=e,this.view.pivot.set(25,25)}update(e){const i=I(this.direction);this.velocity.x=this.direction.x/i*this.maxVelocity||0,this.velocity.y=this.direction.y/i*this.maxVelocity||0,this.view.x+=this.velocity.x*e,this.view.y+=this.velocity.y*e}}class b extends E{constructor(){super();r(this,"maxVelocity",3);this.view.tint=15680580}}class F{constructor(){r(this,"view",new PIXI.Container);r(this,"list",[]);r(this,"spawnTimer",T(this.spawn,1e3,this));for(let e=0;e<10;e++)this.spawn()}spawn(){const e=new b,{width:i,height:t}=a();e.view.position.set(Math.random()*i-i/2,Math.random()*t-t/2),Math.random()>.5?e.view.position.x=Math.random()>.5?-i/2:i/2:e.view.position.y=Math.random()>.5?-t/2:t/2,this.list.push(e),this.view.addChild(e.view)}update(e){this.spawnTimer.update(),this.list.forEach(i=>{const t=X(i.view.position,C()),s=N(t);i.direction.copyFrom(s),i.update(e)})}}const f=class extends PIXI.utils.EventEmitter{constructor(){super();r(this,"keys",{w:0,s:0,a:0,d:0,1:0,0:0});r(this,"onKeyDown",({key:i})=>{i in this.keys&&(this.keys[i]=1,this.emit(f.EVENTS.KEYDOWN,{key:i}))});r(this,"onKeyUp",({key:i})=>{i in this.keys&&(this.keys[i]=0,this.emit(f.EVENTS.KEYUP,{key:i}))});window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)}};let d=f;r(d,"EVENTS",{KEYDOWN:"KEYDOWN",KEYDOWN:"KEYUP"});const v=class extends PIXI.utils.EventEmitter{constructor(i=16777215){super();r(this,"view",new PIXI.Container);r(this,"pressed",!1);r(this,"direction",new PIXI.Point);const t=new PIXI.Graphics;t.beginFill(i),t.drawCircle(0,0,50),t.endFill(),this.view.addChild(t),this.view.hitArea=new PIXI.Circle(0,0,150);const s=new PIXI.Graphics;s.beginFill(i),s.drawCircle(this.view.hitArea.x,this.view.hitArea.y,this.view.hitArea.radius),s.endFill(),s.alpha=.04,this.view.addChild(s),this.view.interactive=!0,this.view.cursor="pointer";const o=c=>{this.pressed=c,t.tint=c?11184810:16777215,c||t.position.set(0,0),this.direction.copyFrom(t.position),this.emitUpdate()};this.view.on("pointerdown",c=>{this.view.toLocal(c.global,null,t.position),o(!0),this.direction.copyFrom(t.position)}),this.view.on("pointerup",()=>{o(!1)}),this.view.on("pointerupoutside",()=>{o(!1)}),this.view.on("pointerout",()=>{o(!1)}),this.view.on("pointermove",c=>{this.pressed&&(this.view.toLocal(c.global,null,t.position),this.direction.copyFrom(t.position),this.emitUpdate())})}emitUpdate(){this.emit(v.EVENTS.INPUT,{direction:this.direction.clone()})}};let h=v;r(h,"EVENTS",{INPUT:"INPUT"});class U extends E{constructor(){super();r(this,"maxVelocity",5);this.view.tint=8702998}connectWSAD(i){i.on(d.EVENTS.KEYDOWN,({key:t})=>{t==="w"?this.direction.y=-1:t==="s"?this.direction.y=1:t==="a"?this.direction.x=-1:t==="d"&&(this.direction.x=1)}),i.on(d.EVENTS.KEYUP,({key:t})=>{t==="w"?this.direction.y=i.keys.s?1:0:t==="s"?this.direction.y=i.keys.w?-1:0:t==="a"?this.direction.x=i.keys.d?1:0:t==="d"&&(this.direction.x=i.keys.a?-1:0)})}connectJoystick(i){i.on(h.EVENTS.INPUT,({direction:t})=>{this.direction.copyFrom(t),console.log(t)})}}class l extends PIXI.utils.EventEmitter{constructor(i=null,t=16777215){super();r(this,"view",new PIXI.Container);r(this,"pressed",!1);const s=new PIXI.Graphics;if(s.beginFill(t),s.drawRect(0,0,100,100),s.endFill(),this.view.addChild(s),i){const c=new PIXI.Text(i);c.anchor.set(.5,.5),c.position.set(50,50),this.view.addChild(c)}s.interactive=!0,s.cursor="pointer";const o=c=>{this.pressed=c,s.tint=c?14342874:16777215};s.on("pointerdown",()=>{o(!0)}),s.on("pointerup",()=>{o(!1)}),s.on("pointerupoutside",()=>{o(!1)})}}r(l,"EVENTS",{PRESSED:"PRESSED"});class V{constructor(){r(this,"view",new PIXI.Container);r(this,"joystick",null);this.initWebUI()}initMobileUI(){}initWebUI(){const e=new l("1",4841033);e.view.position.set(25,0);const i=new l("2",14567753);i.view.position.set(150,0);const t=new l("3",4803038);t.view.position.set(275,0),this.joystick=new h(16448250);const s=a();this.joystick.view.position.set(s.width-125,0),this.view.addChild(e.view,i.view,t.view,this.joystick.view),this.view.y=s.height-125,m().on("resize",()=>{const o=a();this.view.y=o.height-125,this.joystick.view.x=o.width-75})}}class D{constructor(e){r(this,"view",new PIXI.Container);const i=new U,t=new PIXI.Container;P({player:i,app:e});const s=new d,o=new S,c=new F,u=new V;i.connectWSAD(s),u.joystick&&i.connectJoystick(u.joystick),e.ticker.add(i.update,i),e.ticker.add(c.update,c),t.pivot.set(-e.renderer.width/2,-e.renderer.height/2),e.ticker.add(()=>{t.pivot.set(-e.renderer.width/2+i.view.x,-e.renderer.height/2+i.view.y)}),this.view.addChild(o.view),t.addChild(c.view),t.addChild(i.view),this.view.addChild(t),this.view.addChild(u.view)}}const p=new PIXI.Application({resizeTo:window});document.body.appendChild(p.view);const K=new D(p);p.stage.addChild(K.view);
